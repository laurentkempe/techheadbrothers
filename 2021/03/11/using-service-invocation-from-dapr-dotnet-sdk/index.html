<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/ico" href="/favicon.ico"><meta name="generator" content="Astro v5.1.1"><title>Laurent Kempé</title><link rel="stylesheet" href="/_astro/_slug_.DnmLDlos.css">
<style>a[data-astro-cid-5grsw2hi]{color:#00539f}.tags[data-astro-cid-5grsw2hi]{display:flex;flex-wrap:wrap}.tag[data-astro-cid-5grsw2hi]{margin:.25em;border:dotted 1px #a1a1a1;border-radius:.5em;padding:.5em 1em;font-size:1.15em;background-color:#f8fcfd}
[data-astro-image]{width:100%;height:auto;-o-object-fit:var(--fit);object-fit:var(--fit);-o-object-position:var(--pos);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <header class="py-6 border-b container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"> <nav class="container mx-auto px-4 flex flex-col sm:flex-row items-center justify-between"> <div class="text-2xl font-bold mb-4 sm:mb-0"> <a href="/">Laurent Kempé</a> </div> <div class="flex gap-6 text-gray-600"> <a href="/" class="hover:text-gray-900 ">Home</a> <a href="/blog" class="hover:text-gray-900 ">Blog</a> <a href="/speaking" class="hover:text-gray-900 ">Speaking</a> <a href="/about-laurent-kempe" class="hover:text-gray-900 ">About</a> </div> </nav> </header> <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">  <p data-astro-cid-5grsw2hi>Thu Mar 11</p> <p data-astro-cid-5grsw2hi><em data-astro-cid-5grsw2hi></em></p> <img src="https://live.staticflickr.com/4403/36848905226_5406f5d177_h.jpg" width="600" alt="Moorea, Polynésie française" data-astro-cid-5grsw2hi>Moorea, Polynésie française <article class="prose prose-lg max-w-none dark:prose-invert
             prose-h1:font-bold prose-h1:text-xl
             prose-a:text-blue-600 prose-p:text-justify prose-img:rounded-xl
             prose-headings:underline"> <h1>Using Service Invocation from Dapr .NET SDK</h1> <p>In the previous post “<a href="https://laurentkempe.com/2021/03/09/getting-started-with-dapr-for-dotnet-developers/">Getting started with Dapr for .NET Developers</a>” we have seen how easy it was to expose a web API written in .NET and the power of exposing it through Dapr sidecar. In this post, we are looking at the different possible ways to invoke that service.</p>
<!-- more -->
<h1 id="introduction">Introduction</h1>
<p><a href="https://dapr.io/">Dapr</a> through its <a href="https://docs.dapr.io/developing-applications/building-blocks/service-invocation/service-invocation-overview/">Service Invocation building block</a> makes it easy to have your application reliably and securely communicate with other applications using the standard HTTP protocols.</p>
<p>It is possible to invoke service by just leveraging the HTTP protocol and a simple <a href="https://docs.microsoft.com/en-us/dotnet/api/system.net.http.httpclient?view=net-5.0">.NET HttpClient</a>.</p>
<h1 id="calling-dapr-sidecar-with-net-httpclient">Calling Dapr sidecar with .NET HttpClient</h1>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Collections</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Generic</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Net</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Http</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Net</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Http</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Json</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> WeatherForecastServiceGrpcClient</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> client</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> HttpClient</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> weatherForecasts</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#E1E4E8"> client.</span><span style="color:#B392F0">GetFromJsonAsync</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">List</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">WeatherForecast</span><span style="color:#E1E4E8">>>(</span></span>
<span class="line"><span style="color:#9ECBFF">        "http://localhost:3500/v1.0/invoke/weatherforecastservice/method/weatherforecast"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">foreach</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">var</span><span style="color:#B392F0"> weatherForecast</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> weatherForecasts)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    Console.</span><span style="color:#B392F0">WriteLine</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">        $"Date:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">Date</span><span style="color:#9ECBFF">}, TemperatureC:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">TemperatureC</span><span style="color:#9ECBFF">}, Summary:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">Summary</span><span style="color:#9ECBFF">}"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>And the results looks like this</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="powershell"><code><span class="line"><span style="color:#E1E4E8">Date:</span><span style="color:#79B8FF">3</span><span style="color:#F97583">/</span><span style="color:#79B8FF">10</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2021</span><span style="color:#79B8FF"> 9</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">21</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8"> PM</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> TemperatureC:</span><span style="color:#79B8FF">10</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> Summary:Sweltering</span></span>
<span class="line"><span style="color:#E1E4E8">Date:</span><span style="color:#79B8FF">3</span><span style="color:#F97583">/</span><span style="color:#79B8FF">11</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2021</span><span style="color:#79B8FF"> 9</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">21</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8"> PM</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> TemperatureC:</span><span style="color:#79B8FF">-18</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> Summary:Sweltering</span></span>
<span class="line"><span style="color:#E1E4E8">Date:</span><span style="color:#79B8FF">3</span><span style="color:#F97583">/</span><span style="color:#79B8FF">12</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2021</span><span style="color:#79B8FF"> 9</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">21</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8"> PM</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> TemperatureC:</span><span style="color:#79B8FF">17</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> Summary:Freezing</span></span>
<span class="line"><span style="color:#E1E4E8">Date:</span><span style="color:#79B8FF">3</span><span style="color:#F97583">/</span><span style="color:#79B8FF">13</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2021</span><span style="color:#79B8FF"> 9</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">21</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8"> PM</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> TemperatureC:</span><span style="color:#79B8FF">-17</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> Summary:Bracing</span></span>
<span class="line"><span style="color:#E1E4E8">Date:</span><span style="color:#79B8FF">3</span><span style="color:#F97583">/</span><span style="color:#79B8FF">14</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2021</span><span style="color:#79B8FF"> 9</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">21</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8"> PM</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> TemperatureC:</span><span style="color:#79B8FF">-12</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> Summary:Chilly</span></span></code></pre>
<p>This has the advantage that your code depends only on .NET, no third-party dependencies. The drawback is that you don’t get any help to build the URI to call the service.</p>
<p>You can get some help using the <a href="https://github.com/dapr/dotnet-sdk">Dapr .NET SDK</a>.</p>
<h1 id="calling-dapr-sidecar-with-dapr-httpclient">Calling Dapr sidecar with Dapr HttpClient</h1>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Collections</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Generic</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Net</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Http</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Json</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> Dapr</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Client</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> WeatherForecastServiceGrpcClient</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> client</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> DaprClient.</span><span style="color:#B392F0">CreateInvokeHttpClient</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> weatherForecasts</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#E1E4E8"> client.</span><span style="color:#B392F0">GetFromJsonAsync</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">List</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">WeatherForecast</span><span style="color:#E1E4E8">>>(</span></span>
<span class="line"><span style="color:#9ECBFF">        "http://weatherforecastservice/weatherforecast"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">foreach</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">var</span><span style="color:#B392F0"> weatherForecast</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> weatherForecasts)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    Console.</span><span style="color:#B392F0">WriteLine</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">        $"Date:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">Date</span><span style="color:#9ECBFF">}, TemperatureC:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">TemperatureC</span><span style="color:#9ECBFF">}, Summary:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">Summary</span><span style="color:#9ECBFF">}"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>We get exactly the same output result but this time we just had to craft an easy URI <em>“<a href="http://weatherforecastservice/weatherforecast">http://weatherforecastservice/weatherforecast</a>”</em> composed only of the Dapr <strong>app-id</strong> and the <strong>method-name</strong> of our service.</p>
<h1 id="calling-dapr-sidecar-with-daprclient">Calling Dapr sidecar with DaprClient</h1>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Collections</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Generic</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Net</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Http</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> Dapr</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Client</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> WeatherForecastServiceGrpcClient</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#F97583"> var</span><span style="color:#B392F0"> client</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> DaprClientBuilder</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">Build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> weatherForecasts</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#E1E4E8"> client.</span><span style="color:#B392F0">InvokeMethodAsync</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">List</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">WeatherForecast</span><span style="color:#E1E4E8">>>(</span></span>
<span class="line"><span style="color:#E1E4E8">        HttpMethod.Get, </span><span style="color:#9ECBFF">"weatherforecastservice"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"weatherforecast"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#F97583">foreach</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">var</span><span style="color:#B392F0"> weatherForecast</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> weatherForecasts)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    Console.</span><span style="color:#B392F0">WriteLine</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">        $"Date:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">Date</span><span style="color:#9ECBFF">}, TemperatureC:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">TemperatureC</span><span style="color:#9ECBFF">}, Summary:{</span><span style="color:#E1E4E8">weatherForecast</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">Summary</span><span style="color:#9ECBFF">}"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Using the DaprClient we only had to specify the <strong>HTTP method</strong>, the Dapr <strong>app-id</strong> and the <strong>method-name</strong> of our service.</p>
<h1 id="conclusion">Conclusion</h1>
<p>We have seen the different ways developers can use .NET with and without Dapr .NET SDK to call a service exposed through a Dapr sidecar. For some more in-depth reading about that topic, I recommend you to read <a href="https://docs.microsoft.com/en-us/dotnet/architecture/dapr-for-net-developers/service-invocation">“The Dapr service invocation building block”</a> from the <a href="https://docs.microsoft.com/en-us/dotnet/architecture/dapr-for-net-developers/">Dapr for .NET Developers book</a>.</p> </article>  <div class="tags" data-astro-cid-5grsw2hi> <p class="tag" data-astro-cid-5grsw2hi><a href="/tags/.NET" data-astro-cid-5grsw2hi>.NET</a></p><p class="tag" data-astro-cid-5grsw2hi><a href="/tags/Dapr" data-astro-cid-5grsw2hi>Dapr</a></p> </div>  </div> <footer class="py-8"> <div class="container mx-auto gap-4 px-4 text-sm text-gray-600 text-center"> <div>
&copy; 2024 Laurent Kempé. All rights reserved.
</div> <div>
The expressed opinions are my own and do not reflect those of my employer or any third-party entities.
</div> </div> </footer> </body></html> 