<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/ico" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.vidstack.io/player.css"><meta name="generator" content="Astro v5.2.5"><title>Laurent Kempé - Service to service invocation with Refit and Dapr .NET SDK</title><link rel="stylesheet" href="/_astro/_slug_.DKcIe2eh.css">
<style>a[data-astro-cid-5grsw2hi]{color:#00539f}.tags[data-astro-cid-5grsw2hi]{display:flex;flex-wrap:wrap}.tag[data-astro-cid-5grsw2hi]{margin:.25em;border:dotted 1px #a1a1a1;border-radius:.5em;padding:.5em 1em;font-size:1.15em;background-color:#f8fcfd}
</style></head> <body> <header class="py-6 border-b container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"> <nav class="container mx-auto px-4 flex flex-col sm:flex-row items-center justify-between"> <div class="text-2xl font-bold mb-4 sm:mb-0"> <a href="/">Laurent Kempé</a> </div> <div class="flex gap-6 text-gray-600"> <a href="/" class="hover:text-gray-900 ">Home</a> <a href="/blog/1" class="hover:text-gray-900 ">Blog</a> <a href="/speaking" class="hover:text-gray-900 ">Speaking</a> <a href="/about-laurent-kempe" class="hover:text-gray-900 ">About</a> </div> </nav> </header> <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">  <p data-astro-cid-5grsw2hi><em data-astro-cid-5grsw2hi></em></p> <div class="relative pt-1" data-astro-cid-5grsw2hi> <img src="https://live.staticflickr.com/2672/32885107145_a73724e5cf_h.jpg" alt="Anse Caffard, Martinique, France" data-astro-cid-5grsw2hi="true" width="1600" height="1067" loading="lazy" decoding="async" class="w-full"> <div class="absolute text-white top-1/3 left-1/3 transform -translate-x-1/4 -translate-y-1/4" data-astro-cid-5grsw2hi> <p class="text-2xl sm:text-3xl md:text-5xl font-extrabold drop-shadow-[0_4px_3px_rgb(0,0,0,0.5)]" data-astro-cid-5grsw2hi>Service to service invocation with Refit and Dapr .NET SDK</p> <p class="py-2 text-sm sm:text-base" data-astro-cid-5grsw2hi>Mar 18, 2021</p> </div> <p class="absolute text-sm sm:text-xs text-white bottom-5 right-5" data-astro-cid-5grsw2hi>Anse Caffard, Martinique, France</p> </div> <div class="py-4" data-astro-cid-5grsw2hi>  <article class="prose prose-lg max-w-none dark:prose-invert
                    prose-h1:font-bold prose-h1:text-4xl prose-h1:mb-4
                    prose-a:text-blue-600 prose-a:no-underline
                    prose-p:text-justify prose-img:rounded-xl"> <p>In the last post, we have seen how to <a href="https://laurentkempe.com/2021/03/16/service-to-service-invocation-with-dapr-dotnet-sdk/">call a service from another service using the Dapr .NET SDK</a>. In this one, we will have a look at a possible way to simplify the development of the client code using <a href="https://reactiveui.github.io/refit/">Refit</a>, the automatic type-safe REST library for .NET Core, Xamarin, and .NET.</p>

<h1 id="introduction">Introduction</h1>
<p>Refit is a library heavily inspired by Square’s <a href="http://square.github.io/retrofit">Retrofit</a> library, and it turns your REST API into a live interface! It generates for you an implementation of the interface that uses HttpClient to make its calls.
Coupled to the <a href="https://github.com/dapr/dotnet-sdk">Dapr .NET SDK</a> it is a great candidate to reduce the amount of code you need to write to call your Dapr services. And we all know, less code means fewer bugs.</p>
<h1 id="proxy-service">Proxy service</h1>
<p>The only difference from the previous blog post source code for the <code>IWeatherForecastClient</code> interface is that we decorate the interface with a <em>Get</em> attribute coming from Refit and specifying the method on the service which is called, here <em>weatherforecast</em>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Collections</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Generic</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Threading</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Tasks</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> Refit</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">namespace</span><span style="color:#B392F0"> WeatherForecastProxyService</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> interface</span><span style="color:#B392F0"> IWeatherForecastClient</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#E1E4E8">        [</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;/weatherforecast&quot;</span><span style="color:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#B392F0">        Task</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">IEnumerable</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">WeatherForecast</span><span style="color:#E1E4E8">&gt;&gt; </span><span style="color:#B392F0">GetWeatherForecast</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#B392F0"> count</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>As previously, we inject the interface in our web API controller of our first service, so that it can call the second service.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#B392F0">ApiController</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#B392F0">Route</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;[controller]&quot;</span><span style="color:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> WeatherForecastProxyController</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">ControllerBase</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#F97583">        private</span><span style="color:#F97583"> readonly</span><span style="color:#B392F0"> IWeatherForecastClient</span><span style="color:#B392F0"> _weatherForecastClient</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        public</span><span style="color:#B392F0"> WeatherForecastProxyController</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">IWeatherForecastClient</span><span style="color:#B392F0"> weatherForecastClient</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">            _weatherForecastClient </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> weatherForecastClient;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        [</span><span style="color:#B392F0">HttpGet</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">        public</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> Task</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">IEnumerable</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">WeatherForecast</span><span style="color:#E1E4E8">&gt;&gt; </span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#B392F0"> count</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> _weatherForecastClient.</span><span style="color:#B392F0">GetWeatherForecast</span><span style="color:#E1E4E8">(count);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<p>Finally, we need to configure the ASP.NET IOC container, so that it can inject the client based on <code>IWeatherForecastClient</code> created by Refit into the controller. Again, we leverage the Dapr .NET SDK to create the HttpClient using the Dapr appid <em>backend</em> which was used to start our backend service through Dapr. This is the way that the HttpClient knows how to call our <em>backend</em> service and decoupling it from its real address, letting Dapr handle the resolution of its location.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> ConfigureServices</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">IServiceCollection</span><span style="color:#B392F0"> services</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#F97583">        ..</span><span style="color:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        services.</span><span style="color:#B392F0">AddSingleton</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#B392F0">            _</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> RestService.</span><span style="color:#B392F0">For</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">IWeatherForecastClient</span><span style="color:#E1E4E8">&gt;(</span></span>
<span class="line"><span style="color:#E1E4E8">                     DaprClient.</span><span style="color:#B392F0">CreateInvokeHttpClient</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;backend&quot;</span><span style="color:#E1E4E8">)));</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<p>Here is the same result</p>
<p><img src="https://live.staticflickr.com/65535/51034623513_011b0ca0c1_c.jpg" alt="Calling the proxy using Refit"/></p>
<h1 id="conclusion">Conclusion</h1>
<p>In this post, we used <a href="https://reactiveui.github.io/refit/">Refit</a> to simplify the development of the client code needed to call a Dapr service.</p>
<p>You can get access to the code of this blog post on GitHub in the <a href="https://github.com/laurentkempe/daprPlayground/tree/master/ServiceToServiceRefit">ServiceToService Refit</a> folder.</p>
<div class="my-5"> <a class="block max-w-[700px] p-8 rounded-lg border border-text/5 bg-text/[0.025] transition-all duration-200 ease-in-out hover:bg-text/[0.12] hover:border-text/10 text-text no-underline" href="https://github.com/laurentkempe/daprPlayground" target="_blank" style="color: inherit; text-decoration: none;"> <img class="w-20 h-20 rounded-full float-right ml-8 mb-8 mt-2.5" src="https://avatars.githubusercontent.com/u/272612?v=4" alt="laurentkempe avatar"> <p class="text-[1.8rem] tracking-wide m-0"> <span>laurentkempe/</span><b>daprPlayground</b> </p> <p class="text-[0.9rem] my-2.5"> Playground and samples in .NET C# for Dapr </p> <div class="flex items-center gap-16"> <div class="flex flex-row gap-2.5 justify-center"> <svg class="w-[1.1rem] h-[1.1rem] mt-1.5 text-text/70" viewBox="0 0 16 16" fill="currentColor"> <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"></path> </svg> <div class="flex flex-col"> <b class="text-[1.2rem]">18</b> <span class="text-[0.8rem] opacity-70">Stars</span> </div> </div> <div class="flex flex-row gap-2.5 justify-center"> <svg class="w-[1.1rem] h-[1.1rem] mt-1.5 text-text/70" viewBox="0 0 16 16" fill="currentColor"> <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path> </svg> <div class="flex flex-col"> <b class="text-[1.2rem]">6</b> <span class="text-[0.8rem] opacity-70">Forks</span> </div> </div> <div class="flex flex-row gap-2.5 justify-center"> <svg class="w-[1.1rem] h-[1.1rem] mt-1.5 text-text/70" viewBox="0 0 16 16" fill="currentColor"> <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path> <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"></path> </svg> <div class="flex flex-col"> <b class="text-[1.2rem]">0</b> <span class="text-[0.8rem] opacity-70">Issues</span> </div> </div> </div> </a> </div> </article>  </div> <div class="tags" data-astro-cid-5grsw2hi> <p class="tag" data-astro-cid-5grsw2hi><a href="/tags/.NET" data-astro-cid-5grsw2hi>.NET</a></p><p class="tag" data-astro-cid-5grsw2hi><a href="/tags/ASP.NET Core" data-astro-cid-5grsw2hi>ASP.NET Core</a></p><p class="tag" data-astro-cid-5grsw2hi><a href="/tags/Dapr" data-astro-cid-5grsw2hi>Dapr</a></p> </div>  </div> <footer class="py-8"> <div class="container mx-auto gap-4 px-4 text-sm text-gray-600 text-center"> <div>
&copy; 2025 Laurent Kempé. All rights reserved.
</div> <div>
The expressed opinions are my own and do not reflect those of my employer or any third-party entities.
</div> </div> </footer> <script src="https://cdn.vidstack.io/player.core" type="module"></script> <script src="https://cdn.vidstack.io/icons" type="module"></script> </body> </html> 