<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/ico" href="/favicon.ico"><meta name="generator" content="Astro v5.7.0"><link rel="alternate" type="application/rss+xml" title="Laurent Kempé blog" href="https://new.laurentkempe.com/atom.xml"><title>Laurent Kempé - Deploying Docker containers running ASP.NET Core RC2 to Microsoft Azure Cloud</title><link rel="stylesheet" href="/_astro/_slug_.vu3vUCPe.css">
<style>a[data-astro-cid-5grsw2hi]{color:#00539f}.tags[data-astro-cid-5grsw2hi]{display:flex;flex-wrap:wrap}.tag[data-astro-cid-5grsw2hi]{margin:.25em;border:dotted 1px #a1a1a1;border-radius:.5em;padding:.5em 1em;font-size:1.15em;background-color:#f8fcfd}@media (prefers-color-scheme: dark){a[data-astro-cid-5grsw2hi]{color:#7fb3d5}.tag[data-astro-cid-5grsw2hi]{border-color:#5a5a5a;background-color:#2d2d2d}}body,html{margin:0;padding:0;width:100%;overflow-x:hidden}.relative[data-astro-cid-5grsw2hi]{width:100%}.absolute[data-astro-cid-5grsw2hi]{max-width:100%}
</style><style>.twitter-tweet:not(.twitter-tweet-rendered){padding:var(--tc-padding, 1em);border:1px solid var(--tc-border-color, #cfd9de)}.twitter-tweet:not(.twitter-tweet-rendered)>:first-child{margin-top:0}.twitter-tweet:not(.twitter-tweet-rendered)>:last-child{margin-bottom:0}.twitter-tweet.twitter-tweet-rendered{color-scheme:normal}
</style><style>lite-youtube>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}
</style><style>lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:720px}lite-youtube:before{content:attr(data-title);display:block;position:absolute;top:0;background-image:linear-gradient(180deg,#000000ab,#0000008a 14%,#00000026 54%,#0000000d 72%,#0000 94%);height:99px;width:100%;font-family:YouTube Noto,Roboto,Arial,Helvetica,sans-serif;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);font-size:18px;padding:25px 20px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}lite-youtube:hover:before{color:#fff}lite-youtube:after{content:"";display:block;padding-bottom:56.25%}lite-youtube>iframe{width:100%;height:100%;position:absolute;top:0;left:0;border:0}lite-youtube>.lty-playbtn{display:block;width:100%;height:100%;background:no-repeat center/68px 48px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 48"><path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/><path d="M45 24 27 14v20" fill="white"/></svg>');position:absolute;cursor:pointer;z-index:1;filter:grayscale(100%);transition:filter .1s cubic-bezier(0,0,.2,1);border:0}lite-youtube:hover>.lty-playbtn,lite-youtube .lty-playbtn:focus{filter:none}lite-youtube.lyt-activated{cursor:unset}lite-youtube.lyt-activated:before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}.lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}
</style></head> <body class="bg-white dark:bg-gray-900"> <header class="py-6 border-b border-gray-200 dark:border-gray-700 container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"> <nav class="container mx-auto px-4"> <div class="flex items-center justify-between"> <div class="text-2xl font-bold dark:text-gray-300"> <a href="/">Laurent Kempé</a> </div> <!-- Mobile menu button and utilities --> <div class="flex items-center gap-4 md:hidden text-gray-600 dark:text-gray-300"> <div class="flex items-center gap-4"> <a href="/atom.xml" title="RSS Feed" class="hover:text-gray-900 dark:hover:text-gray-100"> <title>RSS Feed</title> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block align-middle" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path> </svg> </a> <theme-toggle> <button title="Dark/Light mode"></button> </theme-toggle> <script type="module">const i=`<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block align-middle" fill="currentColor" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="5"/>
    <g stroke="currentColor" stroke-width="2" stroke-linecap="round">
      <line x1="12" y1="1" x2="12" y2="3"/>
      <line x1="12" y1="21" x2="12" y2="23"/>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
      <line x1="1" y1="12" x2="3" y2="12"/>
      <line x1="21" y1="12" x2="23" y2="12"/>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
    </g>
  </svg>`,s=`<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block align-middle" viewBox="0 0 20 20" fill="currentColor">
    <path d="M17.293 13.293a8 8 0 11-10.586-10.586 8.003 8.003 0 0010.586 10.586z"/>
  </svg>`;class o extends HTMLElement{STORAGE_KEY="theme-preference";_darkTheme=!1;button;constructor(){if(super(),this.button=this.querySelector("button"),!this.button){console.error("Theme toggle button not found");return}const e=localStorage.getItem(this.STORAGE_KEY);e?this.darkTheme=e==="dark":this.darkTheme=window.matchMedia("(prefers-color-scheme: dark)").matches,this.button.addEventListener("click",this.toggleTheme.bind(this)),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{localStorage.getItem(this.STORAGE_KEY)||(this.darkTheme=t.matches)})}get darkTheme(){return this._darkTheme}set darkTheme(e){this._darkTheme=e,document.documentElement.classList.toggle("dark",e),this.button&&(this.button.innerHTML=e?i:s,this.button.setAttribute("aria-label",e?"Switch to light theme":"Switch to dark theme"))}toggleTheme(){this.darkTheme=!this.darkTheme,localStorage.setItem(this.STORAGE_KEY,this.darkTheme?"dark":"light")}}customElements.define("theme-toggle",o);</script> </div> <button id="mobile-menu-button" class="hover:text-gray-900 dark:hover:text-gray-100"> <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path> </svg> </button> </div> <!-- Desktop menu --> <div class="hidden md:flex md:items-center md:gap-6 text-gray-600 dark:text-gray-300"> <a href="/" class="hover:text-gray-900 dark:hover:text-gray-100 ">Home</a> <a href="/blog/1" class="hover:text-gray-900 dark:hover:text-gray-100 ">Blog</a> <a href="/speaking" class="hover:text-gray-900 dark:hover:text-gray-100 ">Speaking</a> <a href="/about-laurent-kempe" class="hover:text-gray-900 dark:hover:text-gray-100 ">About</a> <a href="/all-archives" title="Archives" class="hover:text-gray-900 dark:hover:text-gray-100 flex items-center gap-1 "> <title>Archives</title> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"></path> </svg> </a> <a href="/all-tags" title="Tags" class="hover:text-gray-900 dark:hover:text-gray-100 flex items-center gap-1 "> <title>Tags</title> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"></path> <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"></path> </svg> </a> <a href="/atom.xml" title="RSS Feed" class="hover:text-gray-900 dark:hover:text-gray-100"> <title>RSS Feed</title> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block align-middle" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path> </svg> </a> <theme-toggle> <button title="Dark/Light mode"></button> </theme-toggle>  </div> </div> <!-- Mobile menu panel --> <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4"> <div class="flex flex-col gap-4 text-gray-600 dark:text-gray-300"> <a href="/" class="hover:text-gray-900 dark:hover:text-gray-100 ">Home</a> <a href="/blog/1" class="hover:text-gray-900 dark:hover:text-gray-100 ">Blog</a> <a href="/speaking" class="hover:text-gray-900 dark:hover:text-gray-100 ">Speaking</a> <a href="/about-laurent-kempe" class="hover:text-gray-900 dark:hover:text-gray-100 ">About</a> <a href="/all-archives" title="Archives" class="hover:text-gray-900 dark:hover:text-gray-100 flex items-center gap-1 "> <title>Archives</title> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"></path> </svg> </a> <a href="/all-tags" title="Tags" class="hover:text-gray-900 dark:hover:text-gray-100 flex items-center gap-1 "> <title>Tags</title> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"></path> <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"></path> </svg> </a> </div> </div> </nav> </header> <script type="module">const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");e?.addEventListener("click",()=>{t?.classList.toggle("hidden")});</script> <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">  <p data-astro-cid-5grsw2hi><em data-astro-cid-5grsw2hi></em></p> <div class="relative pt-1" data-astro-cid-5grsw2hi> <img src="https://c6.staticflickr.com/3/2837/9199431893_80c0511daf_h.jpg" alt="Bondi to Bronte coastal walk, Australia" data-astro-cid-5grsw2hi="true" width="1600" height="1067" loading="lazy" decoding="async" class="w-full"> <div class="absolute text-white top-1/3 left-1/3 transform -translate-x-1/4 -translate-y-1/4" data-astro-cid-5grsw2hi> <p class="text-2xl sm:text-3xl md:text-5xl font-extrabold drop-shadow-[0_4px_3px_rgb(0,0,0,0.5)] dark:drop-shadow-[0_4px_3px_rgb(255,255,255,0.5)]" data-astro-cid-5grsw2hi>Deploying Docker containers running ASP.NET Core RC2 to Microsoft Azure Cloud</p> <p class="py-2 text-sm sm:text-base" data-astro-cid-5grsw2hi>Jun 8, 2016</p> </div> <div class="absolute bottom-5 left-5" data-astro-cid-5grsw2hi> <div class="flex gap-1 flex-wrap"><a href="/tags/asp-net-core-rc2" class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">ASP.NET Core RC2</a><a href="/tags/docker" class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">Docker</a><a href="/tags/hipchat-connect" class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">HipChat Connect</a><a href="/tags/microsoft-azure" class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">Microsoft Azure</a></div> </div> <p class="absolute text-sm sm:text-xs text-white bottom-5 right-5" data-astro-cid-5grsw2hi>Bondi to Bronte coastal walk, Australia</p> </div><div class="py-4" data-astro-cid-5grsw2hi>  <article class="prose prose-lg max-w-none dark:prose-invert
                    prose-h1:font-bold prose-h1:text-4xl md:prose-h1:text-4xl prose-h1:text-xl prose-h1:mb-4
                    prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:no-underline
                    prose-p:text-justify prose-img:rounded-xl"> <p>Following my previous post on <a href="https://laurentkempe.com/2016/05/16/ASP-NET-Core-RC2-Docker-and-HipChat-Connect-add-on/">ASP.NET Core RC2, Docker and HipChat Connect add-on</a> I wanted to learn the next step which is to deploy my Docker container on the Microsoft Azure Cloud!</p>

<p>Due to a <a href="https://docs.docker.com/machine/drivers/azure/">known issue</a> and to avoid to have issues with credentials you need to follow the instructions on the following page “<a href="https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-windows-create-aad-work-id/">Creating a Work or School identity in Azure Active Directory to use with Windows VMs</a>”</p>
<blockquote>
<p>KNOWN ISSUE: There is a known issue with Azure Active Directory causing stored credentials to expire within hours rather than 14 days when the user logs in with personal Microsoft Account (formerly Live ID) instead of an Active Directory account. Currently, there is no ETA for resolution, however in the meanwhile, you can <a href="https://azure.microsoft.com/documentation/articles/virtual-machines-windows-create-aad-work-id/">create an AAD account</a> and login with that as a workaround.</p>
</blockquote>
<p>Now to get ready to deploy we need first the following:</p>
<ol>
<li>Get an Azure account on <a href="https://azure.microsoft.com">Azure</a></li>
<li>Get Azure subscription id from Subscriptions link</li>
</ol>
<p><img src="https://c5.staticflickr.com/8/7435/27355205412_b5b2f751fa_o.jpg" alt="Azure subscription id screenshot"/></p>
<p>Then we need to create a machine on the Azure cloud which will host our Docker containers. For that we will use Docker Machine, you can read more about it on this web page “<a href="https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-linux-docker-machine/">Use Docker Machine with the Azure driver</a>”.</p>
<p>Using Docker for Windows, I execute the following docker-machine command to create the machine</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">C:\Users\Laurent</span></span>
<span class="line"><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> docker-machine create --driver azure --azure-location westeurope --azure-subscription-id ADDYOURS hipchatconnect</span></span>
<span class="line"><span style="color:#B392F0">Running</span><span style="color:#9ECBFF"> pre-create</span><span style="color:#9ECBFF"> checks...</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Completed</span><span style="color:#9ECBFF"> machine</span><span style="color:#9ECBFF"> pre-create</span><span style="color:#9ECBFF"> checks.</span></span>
<span class="line"><span style="color:#B392F0">Creating</span><span style="color:#9ECBFF"> machine...</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Querying</span><span style="color:#9ECBFF"> existing</span><span style="color:#9ECBFF"> resource</span><span style="color:#9ECBFF"> group.</span><span style="color:#9ECBFF">  name=&quot;docker-machine&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Resource</span><span style="color:#9ECBFF"> group</span><span style="color:#9ECBFF"> &quot;docker-machine&quot;</span><span style="color:#9ECBFF"> already</span><span style="color:#9ECBFF"> exists.</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Configuring</span><span style="color:#9ECBFF"> availability</span><span style="color:#9ECBFF"> set.</span><span style="color:#9ECBFF">  name=&quot;docker-machine&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Configuring</span><span style="color:#9ECBFF"> network</span><span style="color:#9ECBFF"> security</span><span style="color:#9ECBFF"> group.</span><span style="color:#9ECBFF">  name=&quot;hipchatconnect-firewall&quot;</span><span style="color:#9ECBFF"> location=&quot;westeurope&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Querying</span><span style="color:#9ECBFF"> if</span><span style="color:#9ECBFF"> virtual</span><span style="color:#9ECBFF"> network</span><span style="color:#9ECBFF"> already</span><span style="color:#9ECBFF"> exists.</span><span style="color:#9ECBFF">  name=&quot;docker-machine-vnet&quot;</span><span style="color:#9ECBFF"> location=&quot;westeurope&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Configuring</span><span style="color:#9ECBFF"> subnet.</span><span style="color:#9ECBFF">  name=&quot;docker-machine&quot;</span><span style="color:#9ECBFF"> vnet=&quot;docker-machine-vnet&quot;</span><span style="color:#9ECBFF"> cidr=&quot;192.168.0.0/16&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Creating</span><span style="color:#9ECBFF"> public</span><span style="color:#9ECBFF"> IP</span><span style="color:#9ECBFF"> address.</span><span style="color:#9ECBFF">  name=&quot;hipchatconnect-ip&quot;</span><span style="color:#9ECBFF"> static=</span><span style="color:#79B8FF">false</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Creating</span><span style="color:#9ECBFF"> network</span><span style="color:#9ECBFF"> interface.</span><span style="color:#9ECBFF">  name=&quot;hipchatconnect-nic&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Creating</span><span style="color:#9ECBFF"> storage</span><span style="color:#9ECBFF"> account.</span><span style="color:#9ECBFF">  name=&quot;vhdsomfr2ogy52o&quot;</span><span style="color:#9ECBFF"> location=&quot;westeurope&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">hipchatconnect</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Creating</span><span style="color:#9ECBFF"> virtual</span><span style="color:#9ECBFF"> machine.</span><span style="color:#9ECBFF">  name=&quot;hipchatconnect&quot;</span><span style="color:#9ECBFF"> location=&quot;westeurope&quot;</span><span style="color:#9ECBFF"> size=&quot;Standard_A2&quot;</span><span style="color:#9ECBFF"> username=&quot;docker-user&quot;</span><span style="color:#9ECBFF"> osImage=&quot;canonical:UbuntuServer:15.10:latest&quot;</span></span>
<span class="line"><span style="color:#B392F0">Waiting</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> machine</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> be</span><span style="color:#9ECBFF"> running,</span><span style="color:#9ECBFF"> this</span><span style="color:#9ECBFF"> may</span><span style="color:#9ECBFF"> take</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> few</span><span style="color:#9ECBFF"> minutes...</span></span>
<span class="line"><span style="color:#B392F0">Detecting</span><span style="color:#9ECBFF"> operating</span><span style="color:#9ECBFF"> system</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> created</span><span style="color:#9ECBFF"> instance...</span></span>
<span class="line"><span style="color:#B392F0">Waiting</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> SSH</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> be</span><span style="color:#9ECBFF"> available...</span></span>
<span class="line"><span style="color:#B392F0">Detecting</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> provisioner...</span></span>
<span class="line"><span style="color:#B392F0">Provisioning</span><span style="color:#9ECBFF"> with</span><span style="color:#9ECBFF"> ubuntu</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">systemd</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">...</span></span>
<span class="line"><span style="color:#B392F0">Installing</span><span style="color:#9ECBFF"> Docker...</span></span>
<span class="line"><span style="color:#B392F0">Copying</span><span style="color:#9ECBFF"> certs</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> local</span><span style="color:#9ECBFF"> machine</span><span style="color:#9ECBFF"> directory...</span></span>
<span class="line"><span style="color:#B392F0">Copying</span><span style="color:#9ECBFF"> certs</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> remote</span><span style="color:#9ECBFF"> machine...</span></span>
<span class="line"><span style="color:#B392F0">Setting</span><span style="color:#9ECBFF"> Docker</span><span style="color:#9ECBFF"> configuration</span><span style="color:#9ECBFF"> on</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> remote</span><span style="color:#9ECBFF"> daemon...</span></span>
<span class="line"><span style="color:#B392F0">Checking</span><span style="color:#9ECBFF"> connection</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> Docker...</span></span>
<span class="line"><span style="color:#B392F0">Docker</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> up</span><span style="color:#9ECBFF"> and</span><span style="color:#9ECBFF"> running!</span></span>
<span class="line"><span style="color:#B392F0">To</span><span style="color:#9ECBFF"> see</span><span style="color:#9ECBFF"> how</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> connect</span><span style="color:#9ECBFF"> your</span><span style="color:#9ECBFF"> Docker</span><span style="color:#9ECBFF"> Client</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> Docker</span><span style="color:#9ECBFF"> Engine</span><span style="color:#9ECBFF"> running</span><span style="color:#9ECBFF"> on</span><span style="color:#9ECBFF"> this</span><span style="color:#9ECBFF"> virtual</span><span style="color:#9ECBFF"> machine,</span><span style="color:#9ECBFF"> run:</span><span style="color:#9ECBFF"> C:</span><span style="color:#79B8FF">\P</span><span style="color:#9ECBFF">rogram</span><span style="color:#9ECBFF"> Files</span><span style="color:#79B8FF">\D</span><span style="color:#9ECBFF">ocker</span><span style="color:#79B8FF">\D</span><span style="color:#9ECBFF">ocker</span><span style="color:#79B8FF">\R</span><span style="color:#9ECBFF">esources</span><span style="color:#79B8FF">\b</span><span style="color:#9ECBFF">in</span><span style="color:#79B8FF">\d</span><span style="color:#9ECBFF">ocker-machine.exe</span><span style="color:#9ECBFF"> env</span><span style="color:#9ECBFF"> hipchatconnect</span></span></code></pre>
<p>After a couple of minutes, we can check on the Azure cloud portal, All resources menu, that Azure created everything for us</p>
<p><img src="https://c1.staticflickr.com/8/7006/27177992480_1b3056ce8f_o.jpg" alt="Azure ressources screenshot"/></p>
<p>Finally, we need to get the configuration to talk to that machine, and it’s Docker daemon</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> docker-machine env hipchatconnect</span></span>
<span class="line"><span style="color:#E1E4E8">$Env:DOCKER_TLS_VERIFY = </span><span style="color:#9ECBFF">&quot;1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">$Env:DOCKER_HOST = </span><span style="color:#9ECBFF">&quot;tcp://x.y.z.y:2376&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">$Env:DOCKER_CERT_PATH = </span><span style="color:#9ECBFF">&quot;C:\Users\Laurent\.docker\machine\machines\hipchatconnect&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">$Env:DOCKER_MACHINE_NAME = </span><span style="color:#9ECBFF">&quot;hipchatconnect&quot;</span></span>
<span class="line"><span style="color:#6A737D"># Run this command to configure your shell:</span></span>
<span class="line"><span style="color:#6A737D"># &amp; &quot;C:\Program Files\Docker\Docker\Resources\bin\docker-machine.exe&quot; env hipchatconnect | Invoke-Expression</span></span></code></pre>
<p>Then execute the last line which will configure our local environment</p>
<blockquote>
<p>&amp; “C:\Program Files\Docker\Docker\Resources\bin\docker-machine.exe” env hipchatconnect | Invoke-Expression</p>
</blockquote>
<p>Now each docker commands will be executed by the machine hosted on Azure cloud.
Easy and awesome!</p>
<p>Next step is to have a Docker container to deploy! We will use the container from my previous post “<a href="http://laurentkempe.com/2016/05/16/ASP-NET-Core-RC2-Docker-and-HipChat-Connect-add-on/">ASP.NET Core RC2, Docker and HipChat Connect add-on</a>”.</p>
<p>First, we need to build an image using the following command</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> docker build -t hipchatconnect </span><span style="color:#79B8FF">.</span></span>
<span class="line"><span style="color:#B392F0">Sending</span><span style="color:#9ECBFF"> build</span><span style="color:#9ECBFF"> context</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> Docker</span><span style="color:#9ECBFF"> daemon</span><span style="color:#79B8FF"> 1.441</span><span style="color:#9ECBFF"> MB</span></span>
<span class="line"><span style="color:#B392F0">Step</span><span style="color:#79B8FF"> 1</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF"> FROM</span><span style="color:#9ECBFF"> microsoft/dotnet</span></span>
<span class="line"><span style="color:#B392F0">latest:</span><span style="color:#9ECBFF"> Pulling</span><span style="color:#9ECBFF"> from</span><span style="color:#9ECBFF"> microsoft/dotnet</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">8b87079b7a06:</span><span style="color:#9ECBFF"> Pull</span><span style="color:#9ECBFF"> complete</span></span>
<span class="line"><span style="color:#B392F0">a3ed95caeb02:</span><span style="color:#9ECBFF"> Pull</span><span style="color:#9ECBFF"> complete</span></span>
<span class="line"><span style="color:#B392F0">1bb8eaf3d643:</span><span style="color:#9ECBFF"> Pull</span><span style="color:#9ECBFF"> complete</span></span>
<span class="line"><span style="color:#B392F0">3e04171ce2e5:</span><span style="color:#9ECBFF"> Pull</span><span style="color:#9ECBFF"> complete</span></span>
<span class="line"><span style="color:#B392F0">bd09d56bccd6:</span><span style="color:#9ECBFF"> Pull</span><span style="color:#9ECBFF"> complete</span></span>
<span class="line"><span style="color:#B392F0">5d7408f25e6a:</span><span style="color:#9ECBFF"> Pull</span><span style="color:#9ECBFF"> complete</span></span>
<span class="line"><span style="color:#B392F0">Digest:</span><span style="color:#9ECBFF"> sha256:5ffec15e54ce30c40dc40d81222d87495b675d81d68c68eda09558d62ac211aa</span></span>
<span class="line"><span style="color:#B392F0">Status:</span><span style="color:#9ECBFF"> Downloaded</span><span style="color:#9ECBFF"> newer</span><span style="color:#9ECBFF"> image</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> microsoft/dotnet:latest</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">ceef90b6765e</span></span>
<span class="line"><span style="color:#B392F0">Step</span><span style="color:#79B8FF"> 2</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF"> ENV</span><span style="color:#9ECBFF"> ASPNETCORE_URLS</span><span style="color:#9ECBFF"> &quot;http://*:5000&quot;</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">Running</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> fd2186f53b53</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">e97d74f73f17</span></span>
<span class="line"><span style="color:#B392F0">Removing</span><span style="color:#9ECBFF"> intermediate</span><span style="color:#9ECBFF"> container</span><span style="color:#9ECBFF"> fd2186f53b53</span></span>
<span class="line"><span style="color:#B392F0">Step</span><span style="color:#79B8FF"> 3</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF"> ENV</span><span style="color:#9ECBFF"> ASPNETCORE_ENVIRONMENT</span><span style="color:#9ECBFF"> &quot;Development&quot;</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">Running</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> 5e768a476c06</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">cfcafa6ec0b4</span></span>
<span class="line"><span style="color:#B392F0">Removing</span><span style="color:#9ECBFF"> intermediate</span><span style="color:#9ECBFF"> container</span><span style="color:#9ECBFF"> 5e768a476c06</span></span>
<span class="line"><span style="color:#B392F0">Step</span><span style="color:#79B8FF"> 4</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF"> COPY</span><span style="color:#9ECBFF"> .</span><span style="color:#9ECBFF"> /app</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">c306c31742cc</span></span>
<span class="line"><span style="color:#B392F0">Removing</span><span style="color:#9ECBFF"> intermediate</span><span style="color:#9ECBFF"> container</span><span style="color:#9ECBFF"> 1bdb65029a8a</span></span>
<span class="line"><span style="color:#B392F0">Step</span><span style="color:#79B8FF"> 5</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF"> WORKDIR</span><span style="color:#9ECBFF"> /app</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">Running</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> a41ce7e35415</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">d074cc6cb3fb</span></span>
<span class="line"><span style="color:#B392F0">Removing</span><span style="color:#9ECBFF"> intermediate</span><span style="color:#9ECBFF"> container</span><span style="color:#9ECBFF"> a41ce7e35415</span></span>
<span class="line"><span style="color:#B392F0">Step</span><span style="color:#79B8FF"> 6</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF"> RUN</span><span style="color:#9ECBFF"> dotnet</span><span style="color:#9ECBFF"> restore</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">Running</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> e93f545f01f1</span></span>
<span class="line"><span style="color:#B392F0">log</span><span style="color:#9ECBFF">  :</span><span style="color:#9ECBFF"> Restoring</span><span style="color:#9ECBFF"> packages</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> /app/project.json...</span></span>
<span class="line"><span style="color:#B392F0">info</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF">   GET</span><span style="color:#9ECBFF"> https://www.myget.org/F/aspnetrc2/api/v3/flatcontainer/microsoft.netcore.app/index.json</span></span>
<span class="line"><span style="color:#B392F0">info</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF">   GET</span><span style="color:#9ECBFF"> https://api.nuget.org/v3-flatcontainer/microsoft.netcore.app/index.json</span></span>
<span class="line"><span style="color:#B392F0">info</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF">   GET</span><span style="color:#9ECBFF"> https://api.nuget.org/v3-flatcontainer/microsoft.aspnetcore.mvc/index.json</span></span>
<span class="line"><span style="color:#79B8FF">...</span></span>
<span class="line"><span style="color:#B392F0">NuGet</span><span style="color:#9ECBFF"> Config</span><span style="color:#9ECBFF"> files</span><span style="color:#9ECBFF"> used:</span></span>
<span class="line"><span style="color:#B392F0">/app/nuget.config</span></span>
<span class="line"><span style="color:#B392F0">/root/.nuget/NuGet/NuGet.Config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Feeds</span><span style="color:#9ECBFF"> used:</span></span>
<span class="line"><span style="color:#B392F0">https://www.myget.org/F/aspnetrc2/api/v3/index.json</span></span>
<span class="line"><span style="color:#B392F0">https://api.nuget.org/v3/index.json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Installed:</span></span>
<span class="line"><span style="color:#B392F0">206</span><span style="color:#9ECBFF"> package</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">s</span><span style="color:#E1E4E8">) </span><span style="color:#9ECBFF">to</span><span style="color:#9ECBFF"> /app/project.json</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">e3a436d91604</span></span>
<span class="line"><span style="color:#B392F0">Removing</span><span style="color:#9ECBFF"> intermediate</span><span style="color:#9ECBFF"> container</span><span style="color:#9ECBFF"> e93f545f01f1</span></span>
<span class="line"><span style="color:#B392F0">Step</span><span style="color:#79B8FF"> 7</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF"> EXPOSE</span><span style="color:#79B8FF"> 5000</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">Running</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> d7cee657215f</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">9ee89d4fb68d</span></span>
<span class="line"><span style="color:#B392F0">Removing</span><span style="color:#9ECBFF"> intermediate</span><span style="color:#9ECBFF"> container</span><span style="color:#9ECBFF"> d7cee657215f</span></span>
<span class="line"><span style="color:#B392F0">Step</span><span style="color:#79B8FF"> 8</span><span style="color:#9ECBFF"> :</span><span style="color:#9ECBFF"> ENTRYPOINT</span><span style="color:#9ECBFF"> dotnet</span><span style="color:#9ECBFF"> run</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">Running</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> 333a6914a1d8</span></span>
<span class="line"><span style="color:#B392F0">---</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">b1685a1c81f8</span></span>
<span class="line"><span style="color:#B392F0">Removing</span><span style="color:#9ECBFF"> intermediate</span><span style="color:#9ECBFF"> container</span><span style="color:#9ECBFF"> 333a6914a1d8</span></span>
<span class="line"><span style="color:#B392F0">Successfully</span><span style="color:#9ECBFF"> built</span><span style="color:#9ECBFF"> b1685a1c81f8</span></span>
<span class="line"><span style="color:#B392F0">SECURITY</span><span style="color:#9ECBFF"> WARNING:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> are</span><span style="color:#9ECBFF"> building</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> Docker</span><span style="color:#9ECBFF"> image</span><span style="color:#9ECBFF"> from</span><span style="color:#9ECBFF"> Windows</span><span style="color:#9ECBFF"> against</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> non-Windows</span><span style="color:#9ECBFF"> Docker</span><span style="color:#9ECBFF"> host.</span><span style="color:#9ECBFF"> All</span><span style="color:#9ECBFF"> files</span><span style="color:#9ECBFF"> and</span><span style="color:#9ECBFF"> directories</span><span style="color:#9ECBFF"> added</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> build</span><span style="color:#9ECBFF"> context</span><span style="color:#9ECBFF"> will</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> &#39;-rwxr-xr-x&#39;</span><span style="color:#9ECBFF"> permissions.</span><span style="color:#9ECBFF"> It</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> recommended</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> double</span><span style="color:#9ECBFF"> check</span><span style="color:#9ECBFF"> and</span><span style="color:#9ECBFF"> reset</span><span style="color:#9ECBFF"> permissions</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> sensitive</span><span style="color:#9ECBFF"> files</span><span style="color:#9ECBFF"> and</span><span style="color:#9ECBFF"> directories.</span></span></code></pre>
<p>Then we need to get the public IP of our machine on the Azure portal</p>
<p><img src="https://c6.staticflickr.com/8/7370/26847519653_66bc0cc208_o.jpg" alt="Azure public ip"/></p>
<p>We can run the container on Azure cloud with</p>
<blockquote>
<p>docker run -d -p 80:5000 -e NGROK_URL=‘<a href="http://40.68.122.128">http://40.68.122.128</a>’ hipchatconnect</p>
</blockquote>
<p>To be able to connect to our connector on the HTTP port 80, we will need to configure the firewall</p>
<p><img src="https://c3.staticflickr.com/8/7375/27420164226_eaa9aa3d94_o.jpg" alt="Azure firewall configuration"/></p>
<p>and finally, connect to it!</p>
<p><img src="https://c6.staticflickr.com/8/7515/27383357301_ef760d740b_o.jpg" alt="Docker container running in Azure Cloud result"/></p>
<p>What a great experience to be able to create a machine in the Azure Cloud from the command line and deploy our software so quickly!</p>
<p>Now that it works we will need to tackle the next issue, which is to expose the container through https because <a href="https://developer.atlassian.com/hipchat/about-hipchat-connect">HipChat Connect</a> needs it so that the add-on can be installed in <a href="https://www.hipchat.com/">HipChat</a>. But that’s for another post.</p> </article>  </div>  </div> <footer class="py-8"> <div class="container mx-auto gap-4 px-4 text-sm text-gray-600 dark:text-gray-300 text-center"> <div>
&copy; 2025 Laurent Kempé. All rights reserved.
</div> <div>
The expressed opinions are my own and do not reflect those of my employer or any third-party entities.
</div> </div> </footer> <script>
            const theme = (() => {
              if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
                return localStorage.getItem("theme");
              }
              if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                return "dark";
              }
              return "light";
            })();
          
            if (theme === "light") {
              document.documentElement.classList.remove("dark");
            } else {
              document.documentElement.classList.add("dark");
            }
            window.localStorage.setItem("theme", theme);
        </script> </body> </html> 