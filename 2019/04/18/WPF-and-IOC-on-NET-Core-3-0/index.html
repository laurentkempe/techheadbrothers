<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/ico" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.vidstack.io/player.css"><meta name="generator" content="Astro v5.5.2"><link rel="alternate" type="application/rss+xml" title="Laurent Kempé blog" href="https://new.laurentkempe.com/atom.xml"><title>Laurent Kempé - WPF and IOC on .NET Core 3.0</title><link rel="stylesheet" href="/_astro/_slug_.eJhnQ2Qd.css">
<style>a[data-astro-cid-5grsw2hi]{color:#00539f}.tags[data-astro-cid-5grsw2hi]{display:flex;flex-wrap:wrap}.tag[data-astro-cid-5grsw2hi]{margin:.25em;border:dotted 1px #a1a1a1;border-radius:.5em;padding:.5em 1em;font-size:1.15em;background-color:#f8fcfd}@media (prefers-color-scheme: dark){a[data-astro-cid-5grsw2hi]{color:#7fb3d5}.tag[data-astro-cid-5grsw2hi]{border-color:#5a5a5a;background-color:#2d2d2d}}body,html{margin:0;padding:0;width:100%;overflow-x:hidden}.relative[data-astro-cid-5grsw2hi]{width:100%}.absolute[data-astro-cid-5grsw2hi]{max-width:100%}
</style><style>.twitter-tweet:not(.twitter-tweet-rendered){padding:var(--tc-padding, 1em);border:1px solid var(--tc-border-color, #cfd9de)}.twitter-tweet:not(.twitter-tweet-rendered)>:first-child{margin-top:0}.twitter-tweet:not(.twitter-tweet-rendered)>:last-child{margin-bottom:0}.twitter-tweet.twitter-tweet-rendered{color-scheme:normal}
</style></head> <body class="bg-white dark:bg-gray-900"> <header class="py-6 border-b border-gray-200 dark:border-gray-700 container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl"> <nav class="container mx-auto px-4"> <div class="flex items-center justify-between"> <div class="text-2xl font-bold dark:text-gray-300"> <a href="/">Laurent Kempé</a> </div> <!-- Mobile menu button and utilities --> <div class="flex items-center gap-4 md:hidden text-gray-600 dark:text-gray-300"> <div class="flex items-center gap-4"> <a href="/atom.xml" title="RSS Feed" class="hover:text-gray-900 dark:hover:text-gray-100"> <title>RSS Feed</title> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block align-middle" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path> </svg> </a> <theme-toggle> <button title="Dark/Light mode"></button> </theme-toggle> <script type="module">const i=`<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block align-middle" fill="currentColor" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="5"/>
    <g stroke="currentColor" stroke-width="2" stroke-linecap="round">
      <line x1="12" y1="1" x2="12" y2="3"/>
      <line x1="12" y1="21" x2="12" y2="23"/>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
      <line x1="1" y1="12" x2="3" y2="12"/>
      <line x1="21" y1="12" x2="23" y2="12"/>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
    </g>
  </svg>`,s=`<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block align-middle" viewBox="0 0 20 20" fill="currentColor">
    <path d="M17.293 13.293a8 8 0 11-10.586-10.586 8.003 8.003 0 0010.586 10.586z"/>
  </svg>`;class o extends HTMLElement{STORAGE_KEY="theme-preference";_darkTheme=!1;button;constructor(){if(super(),this.button=this.querySelector("button"),!this.button){console.error("Theme toggle button not found");return}const e=localStorage.getItem(this.STORAGE_KEY);e?this.darkTheme=e==="dark":this.darkTheme=window.matchMedia("(prefers-color-scheme: dark)").matches,this.button.addEventListener("click",this.toggleTheme.bind(this)),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{localStorage.getItem(this.STORAGE_KEY)||(this.darkTheme=t.matches)})}get darkTheme(){return this._darkTheme}set darkTheme(e){this._darkTheme=e,document.documentElement.classList.toggle("dark",e),this.button&&(this.button.innerHTML=e?i:s,this.button.setAttribute("aria-label",e?"Switch to light theme":"Switch to dark theme"))}toggleTheme(){this.darkTheme=!this.darkTheme,localStorage.setItem(this.STORAGE_KEY,this.darkTheme?"dark":"light")}}customElements.define("theme-toggle",o);</script> </div> <button id="mobile-menu-button" class="hover:text-gray-900 dark:hover:text-gray-100"> <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path> </svg> </button> </div> <!-- Desktop menu --> <div class="hidden md:flex md:items-center md:gap-6 text-gray-600 dark:text-gray-300"> <a href="/" class="hover:text-gray-900 dark:hover:text-gray-100 ">Home</a> <a href="/blog/1" class="hover:text-gray-900 dark:hover:text-gray-100 ">Blog</a> <a href="/speaking" class="hover:text-gray-900 dark:hover:text-gray-100 ">Speaking</a> <a href="/about-laurent-kempe" class="hover:text-gray-900 dark:hover:text-gray-100 ">About</a> <a href="/all-archives" title="Archives" class="hover:text-gray-900 dark:hover:text-gray-100 flex items-center gap-1 "> <title>Archives</title> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"></path> </svg> </a> <a href="/all-tags" title="Tags" class="hover:text-gray-900 dark:hover:text-gray-100 flex items-center gap-1 "> <title>Tags</title> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"></path> <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"></path> </svg> </a> <a href="/atom.xml" title="RSS Feed" class="hover:text-gray-900 dark:hover:text-gray-100"> <title>RSS Feed</title> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block align-middle" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path> </svg> </a> <theme-toggle> <button title="Dark/Light mode"></button> </theme-toggle>  </div> </div> <!-- Mobile menu panel --> <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4"> <div class="flex flex-col gap-4 text-gray-600 dark:text-gray-300"> <a href="/" class="hover:text-gray-900 dark:hover:text-gray-100 ">Home</a> <a href="/blog/1" class="hover:text-gray-900 dark:hover:text-gray-100 ">Blog</a> <a href="/speaking" class="hover:text-gray-900 dark:hover:text-gray-100 ">Speaking</a> <a href="/about-laurent-kempe" class="hover:text-gray-900 dark:hover:text-gray-100 ">About</a> <a href="/all-archives" title="Archives" class="hover:text-gray-900 dark:hover:text-gray-100 flex items-center gap-1 "> <title>Archives</title> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"></path> </svg> </a> <a href="/all-tags" title="Tags" class="hover:text-gray-900 dark:hover:text-gray-100 flex items-center gap-1 "> <title>Tags</title> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"></path> <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"></path> </svg> </a> </div> </div> </nav> </header> <script type="module">const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");e?.addEventListener("click",()=>{t?.classList.toggle("hidden")});</script> <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">  <p data-astro-cid-5grsw2hi><em data-astro-cid-5grsw2hi></em></p> <div class="relative pt-1" data-astro-cid-5grsw2hi> <img src="https://live.staticflickr.com/4410/36576108926_d296e0fa6b_h.jpg" alt="Atimaono, Tahiti, France" data-astro-cid-5grsw2hi="true" width="1600" height="1067" loading="lazy" decoding="async" class="w-full"> <div class="absolute text-white top-1/3 left-1/3 transform -translate-x-1/4 -translate-y-1/4" data-astro-cid-5grsw2hi> <p class="text-2xl sm:text-3xl md:text-5xl font-extrabold drop-shadow-[0_4px_3px_rgb(0,0,0,0.5)] dark:drop-shadow-[0_4px_3px_rgb(255,255,255,0.5)]" data-astro-cid-5grsw2hi>WPF and IOC on .NET Core 3.0</p> <p class="py-2 text-sm sm:text-base" data-astro-cid-5grsw2hi>Apr 18, 2019</p> </div> <div class="absolute bottom-5 left-5" data-astro-cid-5grsw2hi> <div class="flex gap-1 flex-wrap"><a href="/tags/dotnet-core" class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">.NET Core</a><a href="/tags/wpf" class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">WPF</a></div> </div> <p class="absolute text-sm sm:text-xs text-white bottom-5 right-5" data-astro-cid-5grsw2hi>Atimaono, Tahiti, France</p> </div><div class="py-4" data-astro-cid-5grsw2hi>  <article class="prose prose-lg max-w-none dark:prose-invert
                    prose-h1:font-bold prose-h1:text-4xl md:prose-h1:text-4xl prose-h1:text-xl prose-h1:mb-4
                    prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:no-underline
                    prose-p:text-justify prose-img:rounded-xl"> <p>At work, we are planning to migrate our WPF application from .NET Framework 4.7 to <a href="https://docs.microsoft.com/en-us/dotnet/core/whats-new/dotnet-core-3-0">.NET Core 3.0</a>. The main reason for doing so is that it was always a big pain to organize the updates of the .NET Framework on our customer machines. So being able to bundle .NET Core with our application is a big plus for us. Then, for sure, we are looking for the performance improvements brought by .NET Core and finally the new capabilities brought by the fast pace of innovation of .NET Core.</p>

<p>This is a great opportunity for us to see and renew a part of the libraries we depend on.</p>
<p>In the current version of our application, we are using <a href="https://github.com/structuremap/structuremap">StructureMap</a> as our <a href="https://en.wikipedia.org/wiki/Inversion_of_control">IOC container</a>. As you might have read <a href="https://jeremydmiller.com/2018/01/29/sunsetting-structuremap/">StructureMap has been sunsetted</a> and replaced by <a href="https://jasperfx.github.io/lamar/">Lamar</a>.</p>
<p>We could have gone to Lamar as it maintains API compatibility with SturtureMap. I just did not want to bring the dependency to Roslyn, but it seems that it was changed in <a href="https://jeremydmiller.com/2019/03/29/lamar-v3-is-released-faster-smaller-quicker-cold-starts-internal-type-friendly/">Lamar 3.0</a>. So, we surely will consider it.</p>
<p>As a first try, I would like to have a look at the IOC container brought by the ASP.NET team; <a href="https://www.nuget.org/packages/Microsoft.Extensions.DependencyInjection/3.0.0-preview4.19216.2">Microsoft Extensions DependencyInjection</a>. Even if it was brought by the ASP.NET team it doesn’t mean at all that it cannot be used outside of ASP.NET!
It is marked as Fast by <a href="https://twitter.com/danielpalme">Daniel Palme</a> in his post ‘<a href="http://www.palmmedia.de/blog/2011/8/30/ioc-container-benchmark-performance-comparison">IoC Container Benchmark - Performance comparison</a>’, so it is a good candidate.</p>
<p>The goal of this post is to see how we could use Microsoft Extensions DependencyInjection in a .NET Core 3.0 with WPF. We will start really easily by creating a new WPF application with the .NET Core CLI.</p>
<h1 id="project-creation">Project creation</h1>
<p>We create our project from the command line.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> mkdir</span><span style="color:#9ECBFF"> WpfIoc</span></span>
<span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> cd</span><span style="color:#9ECBFF"> WpfIoc</span></span>
<span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> dotnet.exe</span><span style="color:#79B8FF"> --version</span></span>
<span class="line"><span style="color:#B392F0">3.0.100-preview4-011223</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> dotnet</span><span style="color:#9ECBFF"> new</span><span style="color:#9ECBFF"> wpf</span></span>
<span class="line"><span style="color:#B392F0">The</span><span style="color:#9ECBFF"> template</span><span style="color:#9ECBFF"> &quot;WPF Application&quot;</span><span style="color:#9ECBFF"> was</span><span style="color:#9ECBFF"> created</span><span style="color:#9ECBFF"> successfully.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Processing</span><span style="color:#9ECBFF"> post-creation</span><span style="color:#9ECBFF"> actions...</span></span>
<span class="line"><span style="color:#B392F0">Running</span><span style="color:#9ECBFF"> &#39;dotnet restore&#39;</span><span style="color:#9ECBFF"> on</span><span style="color:#9ECBFF"> C:</span><span style="color:#79B8FF">\U</span><span style="color:#9ECBFF">sers</span><span style="color:#79B8FF">\l</span><span style="color:#9ECBFF">aure</span><span style="color:#79B8FF">\p</span><span style="color:#9ECBFF">rojects</span><span style="color:#79B8FF">\W</span><span style="color:#9ECBFF">pfIoc</span><span style="color:#79B8FF">\W</span><span style="color:#9ECBFF">pfIoc.csproj...</span></span>
<span class="line"><span style="color:#B392F0">  Restore</span><span style="color:#9ECBFF"> completed</span><span style="color:#9ECBFF"> in</span><span style="color:#79B8FF"> 90.03</span><span style="color:#9ECBFF"> ms</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> C:</span><span style="color:#79B8FF">\U</span><span style="color:#9ECBFF">sers</span><span style="color:#79B8FF">\l</span><span style="color:#9ECBFF">aure</span><span style="color:#79B8FF">\p</span><span style="color:#9ECBFF">rojects</span><span style="color:#79B8FF">\W</span><span style="color:#9ECBFF">pfIoc</span><span style="color:#79B8FF">\W</span><span style="color:#9ECBFF">pfIoc.csproj.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Restore</span><span style="color:#9ECBFF"> succeeded.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> dotnet</span><span style="color:#9ECBFF"> build</span></span>
<span class="line"><span style="color:#B392F0">Microsoft</span><span style="color:#E1E4E8"> (R) Build Engine version 16.1.54-preview+gd004974104 </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> .NET Core</span></span>
<span class="line"><span style="color:#B392F0">Copyright</span><span style="color:#E1E4E8"> (C) Microsoft Corporation. All rights reserved.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  Restore</span><span style="color:#9ECBFF"> completed</span><span style="color:#9ECBFF"> in</span><span style="color:#79B8FF"> 19.92</span><span style="color:#9ECBFF"> ms</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> C:</span><span style="color:#79B8FF">\U</span><span style="color:#9ECBFF">sers</span><span style="color:#79B8FF">\l</span><span style="color:#9ECBFF">aure</span><span style="color:#79B8FF">\p</span><span style="color:#9ECBFF">rojects</span><span style="color:#79B8FF">\W</span><span style="color:#9ECBFF">pfIoc</span><span style="color:#79B8FF">\W</span><span style="color:#9ECBFF">pfIoc.csproj.</span></span>
<span class="line"><span style="color:#B392F0">C:\Program</span><span style="color:#9ECBFF"> Files</span><span style="color:#79B8FF">\d</span><span style="color:#9ECBFF">otnet</span><span style="color:#79B8FF">\s</span><span style="color:#9ECBFF">dk</span><span style="color:#79B8FF">\3</span><span style="color:#9ECBFF">.0.100-preview4-011223</span><span style="color:#79B8FF">\S</span><span style="color:#9ECBFF">dks</span><span style="color:#79B8FF">\M</span><span style="color:#9ECBFF">icrosoft.NET.Sdk</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">argets</span><span style="color:#79B8FF">\M</span><span style="color:#9ECBFF">icrosoft.NET.RuntimeIdentifierInference.targets</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">151,5</span><span style="color:#E1E4E8">)</span><span style="color:#9ECBFF">:</span><span style="color:#9ECBFF"> message</span><span style="color:#9ECBFF"> NETSDK1057:</span><span style="color:#9ECBFF"> You</span><span style="color:#9ECBFF"> are</span><span style="color:#9ECBFF"> using</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> preview</span><span style="color:#9ECBFF"> version</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> .NET</span><span style="color:#9ECBFF"> Core.</span><span style="color:#9ECBFF"> See:</span><span style="color:#9ECBFF"> https://aka.ms/dotnet-core-preview</span><span style="color:#E1E4E8"> [C:</span><span style="color:#79B8FF">\U</span><span style="color:#E1E4E8">sers</span><span style="color:#79B8FF">\l</span><span style="color:#E1E4E8">aure</span><span style="color:#79B8FF">\p</span><span style="color:#E1E4E8">rojects</span><span style="color:#79B8FF">\W</span><span style="color:#E1E4E8">pfIoc</span><span style="color:#79B8FF">\W</span><span style="color:#E1E4E8">pfIoc.csproj]</span></span>
<span class="line"><span style="color:#B392F0">  WpfIoc</span><span style="color:#E1E4E8"> -</span><span style="color:#F97583">&gt;</span><span style="color:#9ECBFF"> C:</span><span style="color:#79B8FF">\U</span><span style="color:#9ECBFF">sers</span><span style="color:#79B8FF">\l</span><span style="color:#9ECBFF">aure</span><span style="color:#79B8FF">\p</span><span style="color:#9ECBFF">rojects</span><span style="color:#79B8FF">\W</span><span style="color:#9ECBFF">pfIoc</span><span style="color:#79B8FF">\b</span><span style="color:#9ECBFF">in</span><span style="color:#79B8FF">\D</span><span style="color:#9ECBFF">ebug</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">etcoreapp3.0</span><span style="color:#79B8FF">\W</span><span style="color:#9ECBFF">pfIoc.dll</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Build</span><span style="color:#9ECBFF"> succeeded.</span></span>
<span class="line"><span style="color:#B392F0">    0</span><span style="color:#9ECBFF"> Warning</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">s</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">    0</span><span style="color:#9ECBFF"> Error</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">s</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Time</span><span style="color:#9ECBFF"> Elapsed</span><span style="color:#9ECBFF"> 00:00:01.63</span></span></code></pre>
<p>What we want to achieve is to bootstrap the application and inject in the constructor of our MainWindow a service which will be called to display some text on the main window of the application.</p>
<h1 id="code">Code</h1>
<p>First, we need to add the reference to the <em>Microsoft Extensions DependencyInjection</em>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">Project</span><span style="color:#B392F0"> Sdk</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;Microsoft.NET.Sdk.WindowsDesktop&quot;</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  &lt;</span><span style="color:#85E89D">PropertyGroup</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">    &lt;</span><span style="color:#85E89D">OutputType</span><span style="color:#E1E4E8">&gt;WinExe&lt;/</span><span style="color:#85E89D">OutputType</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">    &lt;</span><span style="color:#85E89D">TargetFramework</span><span style="color:#E1E4E8">&gt;netcoreapp3.0&lt;/</span><span style="color:#85E89D">TargetFramework</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">    &lt;</span><span style="color:#85E89D">UseWPF</span><span style="color:#E1E4E8">&gt;true&lt;/</span><span style="color:#85E89D">UseWPF</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">  &lt;/</span><span style="color:#85E89D">PropertyGroup</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  &lt;</span><span style="color:#85E89D">ItemGroup</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">    &lt;</span><span style="color:#85E89D">PackageReference</span><span style="color:#B392F0"> Include</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;Microsoft.Extensions.DependencyInjection&quot;</span><span style="color:#B392F0"> Version</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;3.0.0-preview4.19216.2&quot;</span><span style="color:#E1E4E8"> /&gt;  </span></span>
<span class="line"><span style="color:#E1E4E8">  &lt;/</span><span style="color:#85E89D">ItemGroup</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">&lt;/</span><span style="color:#85E89D">Project</span><span style="color:#E1E4E8">&gt;</span></span></code></pre>
<p>Then we create an interface <em>ITextService</em> which will be injected by the container into the MainWindow class.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> interface</span><span style="color:#B392F0"> ITextService</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    string</span><span style="color:#B392F0"> GetText</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>In fact, it is a concrete implementation of that interface which will be injected <em>TextService</em>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TextService</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">ITextService</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> string</span><span style="color:#B392F0"> _text</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> TextService</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">string</span><span style="color:#B392F0"> text</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#E1E4E8">        _text </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> text;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> string</span><span style="color:#B392F0"> GetText</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> _text;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Then we need to configure our IOC container.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#E1E4E8">services.</span><span style="color:#B392F0">AddSingleton</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">ITextService</span><span style="color:#E1E4E8">&gt;(</span><span style="color:#B392F0">provider</span><span style="color:#F97583"> =&gt;</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TextService</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Hi WPF .NET Core 3.0!&quot;</span><span style="color:#E1E4E8">));</span></span></code></pre>
<p>So this also means that we need to have our IOC container creating our WPF MainWindow, no problem it is just another normal C# class.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#E1E4E8">services.</span><span style="color:#B392F0">AddSingleton</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">MainWindow</span><span style="color:#E1E4E8">&gt;();</span></span></code></pre>
<p>Next piece which we need to put in place is the one linking all the other pieces together; the IOC container! That’s quite easy we just need to extend the App class to create <em>ServiceCollection</em> add the dependencies we want the IOC container to manage and then to call <em>BuildServiceProvider</em>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#B392F0"> App</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#B392F0"> serviceCollection</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ServiceCollection</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">    ConfigureServices</span><span style="color:#E1E4E8">(serviceCollection);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    _serviceProvider </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> serviceCollection.</span><span style="color:#B392F0">BuildServiceProvider</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> ConfigureServices</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">IServiceCollection</span><span style="color:#B392F0"> services</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    services.</span><span style="color:#B392F0">AddSingleton</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">ITextService</span><span style="color:#E1E4E8">&gt;(</span><span style="color:#B392F0">provider</span><span style="color:#F97583"> =&gt;</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TextService</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Hi WPF .NET Core 3.0!&quot;</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#E1E4E8">    services.</span><span style="color:#B392F0">AddSingleton</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">MainWindow</span><span style="color:#E1E4E8">&gt;();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Then, on the <em>App_OnStartup</em> we are using the ServiceProvider to get an instance of <em>MainWindow</em> which would get the <em>ITextService</em> injected in its constructor.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> App_OnStartup</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">object</span><span style="color:#B392F0"> sender</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">StartupEventArgs</span><span style="color:#B392F0"> e</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#B392F0"> mainWindow</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> _serviceProvider.</span><span style="color:#B392F0">GetService</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">MainWindow</span><span style="color:#E1E4E8">&gt;();</span></span>
<span class="line"><span style="color:#E1E4E8">    mainWindow.</span><span style="color:#B392F0">Show</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>We also modified <em>App.xaml</em> to call <em>App_OnStartup</em>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">Application</span><span style="color:#B392F0"> x:Class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;wpfioc.App&quot;</span></span>
<span class="line"><span style="color:#B392F0">             xmlns</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span>
<span class="line"><span style="color:#B392F0">             xmlns:x</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span></span>
<span class="line"><span style="color:#B392F0">             xmlns:local</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;clr-namespace:wpfioc&quot;</span></span>
<span class="line"><span style="color:#B392F0">             Startup</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;App_OnStartup&quot;</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">    &lt;</span><span style="color:#85E89D">Application.Resources</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">    &lt;/</span><span style="color:#85E89D">Application.Resources</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">&lt;/</span><span style="color:#85E89D">Application</span><span style="color:#E1E4E8">&gt;</span></span></code></pre>
<p>Finally, we modify the XAML of the MainWindow to display some text in a Label.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">Window</span><span style="color:#B392F0"> x:Class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;WpfIoc.MainWindow&quot;</span></span>
<span class="line"><span style="color:#B392F0">        xmlns</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span>
<span class="line"><span style="color:#B392F0">        xmlns:x</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span></span>
<span class="line"><span style="color:#B392F0">        xmlns:d</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span></span>
<span class="line"><span style="color:#B392F0">        xmlns:mc</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span></span>
<span class="line"><span style="color:#B392F0">        xmlns:local</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;clr-namespace:WpfIoc&quot;</span></span>
<span class="line"><span style="color:#B392F0">        mc:Ignorable</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;d&quot;</span></span>
<span class="line"><span style="color:#B392F0">        Title</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;MainWindow&quot;</span><span style="color:#B392F0"> Height</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;450&quot;</span><span style="color:#B392F0"> Width</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;800&quot;</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">    &lt;</span><span style="color:#85E89D">Grid</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">        &lt;</span><span style="color:#85E89D">Grid.RowDefinitions</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">            &lt;</span><span style="color:#85E89D">RowDefinition</span><span style="color:#B392F0"> Height</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;9*&quot;</span><span style="color:#E1E4E8"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">            &lt;</span><span style="color:#85E89D">RowDefinition</span><span style="color:#B392F0"> Height</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;1*&quot;</span><span style="color:#E1E4E8"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">        &lt;/</span><span style="color:#85E89D">Grid.RowDefinitions</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">        &lt;</span><span style="color:#85E89D">Label</span><span style="color:#B392F0"> Name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;Label&quot;</span><span style="color:#B392F0"> Content</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;Hello .NET Core!&quot;</span><span style="color:#B392F0"> HorizontalAlignment</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;Center&quot;</span><span style="color:#B392F0"> VerticalAlignment</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;Center&quot;</span><span style="color:#B392F0"> FontSize</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;40&quot;</span><span style="color:#E1E4E8"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">    &lt;/</span><span style="color:#85E89D">Grid</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">&lt;/</span><span style="color:#85E89D">Window</span><span style="color:#E1E4E8">&gt;</span></span></code></pre>
<p>And we inject through the constructor, the <em>ITextService</em> interface which is used to set the Label text.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> partial</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> MainWindow</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">Window</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#F97583">        public</span><span style="color:#B392F0"> MainWindow</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">ITextService</span><span style="color:#B392F0"> textService</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#B392F0">            InitializeComponent</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">            Label.Content </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> textService.</span><span style="color:#B392F0">GetText</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<h1 id="result">Result</h1>
<p>We can run the application and see that <em>TextService</em> is called and the WPF application correctly displays the text.</p>
<p><img src="https://live.staticflickr.com/65535/40675205763_ab0cd3c28b_o.png%22" alt="WPF IOC"/></p>
<p>You can get all the code on GitHub</p>
<div class="my-5"> <a class="block max-w-[700px] p-8 rounded-lg border border-text/5 bg-text/[0.025] transition-all duration-200 ease-in-out hover:bg-text/[0.12] hover:border-text/10 text-text dark:bg-text/[0.15] dark:border-text/20 dark:hover:bg-text/[0.25] dark:hover:border-text/30 no-underline" href="https://github.com/laurentkempe/WpfIoc" target="_blank" style="color: inherit; text-decoration: none;"> <img class="w-20 h-20 rounded-full float-right ml-8 mb-8 mt-2.5" src="https://avatars.githubusercontent.com/u/272612?v=4" alt="laurentkempe avatar"> <p class="text-[1.8rem] tracking-wide m-0"> <span>laurentkempe/</span><b>WpfIoc</b> </p> <p class="text-[0.9rem] my-2.5"> .NET Core 3.0 Wpf application using Ioc </p> <div class="flex items-center gap-16"> <div class="flex flex-row gap-2.5 justify-center"> <svg class="w-[1.1rem] h-[1.1rem] mt-1.5 text-text/70 dark:text-text/50" viewBox="0 0 16 16" fill="currentColor"> <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"></path> </svg> <div class="flex flex-col"> <b class="text-[1.2rem]">13</b> <span class="text-[0.8rem] opacity-70 dark:opacity-50">Stars</span> </div> </div> <div class="flex flex-row gap-2.5 justify-center"> <svg class="w-[1.1rem] h-[1.1rem] mt-1.5 text-text/70 dark:text-text/50" viewBox="0 0 16 16" fill="currentColor"> <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path> </svg> <div class="flex flex-col"> <b class="text-[1.2rem]">6</b> <span class="text-[0.8rem] opacity-70 dark:opacity-50">Forks</span> </div> </div> <div class="flex flex-row gap-2.5 justify-center"> <svg class="w-[1.1rem] h-[1.1rem] mt-1.5 text-text/70 dark:text-text/50" viewBox="0 0 16 16" fill="currentColor"> <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path> <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"></path> </svg> <div class="flex flex-col"> <b class="text-[1.2rem]">0</b> <span class="text-[0.8rem] opacity-70 dark:opacity-50">Issues</span> </div> </div> </div> </a> </div> </article>  </div>  </div> <footer class="py-8"> <div class="container mx-auto gap-4 px-4 text-sm text-gray-600 dark:text-gray-300 text-center"> <div>
&copy; 2025 Laurent Kempé. All rights reserved.
</div> <div>
The expressed opinions are my own and do not reflect those of my employer or any third-party entities.
</div> </div> </footer> <script>
            const theme = (() => {
              if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
                return localStorage.getItem("theme");
              }
              if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                return "dark";
              }
              return "light";
            })();
          
            if (theme === "light") {
              document.documentElement.classList.remove("dark");
            } else {
              document.documentElement.classList.add("dark");
            }
            window.localStorage.setItem("theme", theme);
        </script> <script src="https://cdn.vidstack.io/player.core" type="module"></script> <script src="https://cdn.vidstack.io/icons" type="module"></script> </body> </html> 